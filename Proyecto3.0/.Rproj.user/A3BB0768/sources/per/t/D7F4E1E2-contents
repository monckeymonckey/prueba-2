---
title: "Proyecto Final"
author: ''
date: ''
output:
  html_document: default
  pdf_document: default
---

# Inform치tica en Ecolog칤a

### Profesores: Aline Pingarroni Mart칤n del Campo y Daniel Mart칤n Auliz Ortiz

### Equipo 1: Andrea Hermenegildo Gonz치lez y David Fidel Rojas Aguilar

## An치lisis multivariado de los patrones de contaminaci칩n atmosf칠rica en las 32 entidades federativas de la Rep칰blica Mexicana y la determinaci칩n de la emisi칩n de contaminantes atmosf칠ricos por tipo de fuente

![](contaminacion.jpg)

### Base de datos 1: "Inventario de emisiones de contaminantes atmosf칠ricos por municipio y fuente, 2018"

### Fuente: Plataforma Nacional de Datos Abiertos. (SEMARNAT, 2018). <https://datos.gob.mx/dataset/calidad_aire_emisiones_contaminantes/resource/70dfeb69-065b-4ed4-8922-505602666250>

### Base de datos 2: "Poblaci칩n total, indicadores socioecon칩micos, 칤ndice y grado de marginaci칩n por municipio"

### Fuente: Plataforma Nacional de Datos Abiertos. (INEGI). <https://datos.gob.mx/dataset/indices_marginacion/resource/d217f9aa-70e5-4176-b00b-3a92b7541a1e>


## Marco Te칩rico:

### El Inventario Nacional de Emisiones de M칠xico (INEM) permite identificar las principales fuentes de emisi칩n para establecer y proyectar las emisiones de M칠xico, utilizando herramientas que calculan las emisiones de contaminantes de diversas fuentes en una regi칩n espec칤fica, a nivel municipal o estatal, durante un a침o en concreto, conocido como a침o base.

### Estos inventarios ayudan a identificar las principales fuentes de contaminaci칩n, medir las emisiones y evaluar su impacto en la salud p칰blica y el medio ambiente. Esta informaci칩n permite a las autoridades y organizaciones dise침ar estrategias efectivas para reducir las emisiones y cumplir con las normativas ambientales, adem치s, los inventarios de emisiones son esenciales para la investigaci칩n cient칤fica y el desarrollo de tecnolog칤as m치s limpias y eficientes.


## Tipos de Fuentes

### 1. Fuentes fijas:
### Instalaciones de ubicaci칩n fija que tienen como finalidad desarrollar operaciones o procesos industriales de manufactura

### 2. Fuentes m칩viles que circulan por carretera:
### Veh칤culos con motores de combusti칩n y similares que abarca una variedad de veh칤culos como: tractocamiones, autobuses, camiones, autom칩viles, motocicletas

### 3. Fuentes m칩viles que no circulan por carretera:
### Veh칤culos con motores de combusti칩n y similares, comprenden: aviones, helic칩pteros, ferrocarriles, tranv칤as, embarcaciones, equipo y maquinarias.

### 4. Fuentes de 치rea:
### Fuentes peque침as, numerosas y dispersas; abarca los comercios, servicios, viviendas, entre otros establecimientos.

### 5. Fuentes naturales:
### Emisiones biog칠nicas, las emisiones del suelo y la erosi칩n e칩lica


## Contaminantes medidos:

### 1. Di칩xido de azufre (SO2)

### 2. Mon칩xido de carbono(CO)

### 3. 칍xidos de nitr칩geno (NOx)

### 4. Compuestos Org치nicos Vol치tiles(COV)

### 5. Part칤culas igual o menores a 10 micr칩metros (PM10)

### 6. Part칤culas igual o menores a 2.5 micr칩metros (PM2.5)

### 7. Amoniaco (NH3)



## 쯈u칠 tipos de fuentes contribuyeron m치s a la emisi칩n de cada tipo de contaminate? y 쮺칩mo se agrupan los estados de M칠xico seg칰n su perfil de emisiones de distintos contaminantes, y qu칠 contaminantes explican esas diferencias?



## 1. Cargar librer칤as necesarias

```{r message=FALSE, warning=FALSE}
#install.packages("tidyverse")
library(tidyverse) #procesamiento de datos
#install.packages("readxl")
library(readxl)
#install.packages("ggplot2")
library(ggplot2)
#install.packages("dplyr")
library(dplyr)
#install.packages("ggridges")
library(ggridges)
#install.packages("tidyr")
library(tidyr)
#install.packages("writexl")
library(writexl)
#install.packages("rgbif")
library(rgbif) #descargar datos de ocurrencias
#install.packages("sf")
library(sf) #manipulaci?n  de datos vectoriales
#install.packages("rworldxtra")
library(rworldxtra) #datos vectoriales de los paises del mundo
#install.packages("geodata")
library(geodata) #datos geoespaciales complemenatarios
#install.packages("ggspatial")
library(ggspatial)#auxiliar para visualizar datos espaciales
#install.packages("terra")
library(terra) #datos raster
#install.packages("tidyterra")
library(tidyterra) #maniipulaci?n de raster
#install.packages("paletteer")
library(paletteer) #colores
#install.packages("ggcorrplot")
library(ggcorrplot) #diagrama de correlaciones
#install.packages("plotly")
library(plotly) #gr?ficos avanzados
#install.packages("patchwork")
library(patchwork) #organizar gr?ficos
#install.packages("magick")
library(magick) #para manejo de imagenes
#install.packages("grid")
library(grid)
#install.packages("factoextra")
library(factoextra)
#install.packages("ggfortify")
library(ggfortify)

```


## 2. Importaci칩n y modificaci칩n de base de datos

### 2.1 Poblaci칩n

```{r message=FALSE, warning=FALSE}

#Guarda en pt la 2춿 hoja de la base original pues esta contiene las mediciones.
pt <- read_excel("IMM_2020.xlsx", sheet = 2)

#Toda la informaci칩n del 칰ltimo censo en 2020
head(pt)

pob <- pt %>%
  group_by(NOM_ENT) %>% #agrupa por estados
  summarize(Poblacion_total = sum(POB_TOT, na.rm = TRUE)
   #suma las poblaciones de cada municipio, guardandolo el Poblacion_total, y esto lo tendr치 en una fila por estado         
            )
#pob es la tabla de estados de M칠xico y la poblacipon regsitrada en el a침o 2020
head(pob)

```


### 2.2 츼rea de estados

```{r message=FALSE, warning=FALSE}

#Guardamos el archivo de las entidades de tipo shp
mexshp <- st_read("entidades_mex.shp")

#Guardamos en estados como dataframe
estados <- as.data.frame(mexshp)

```


### 2.3 Combinaci칩n de poblaci칩n y geograf칤a de cada estado

```{r message=FALSE, warning=FALSE}
#Qu칠 nombres maneja estados y pob
unique(estados$NOMGEO)

unique(pob$NOM_ENT)
#Estado, Michoac치n y Veracruz no coinciden

#Modificamos los nombres de pob para que coincidan en la uni칩n
pob <- pob %>%
  #Dentro de pob...
  mutate( #...modifica las colmunas.
    NOM_ENT = case_when( #En espec칤fico a esta <<En caso de...>>
      NOM_ENT== "M칠xico" ~ "Estado de M칠xico",
      NOM_ENT == "Michoac치n de Ocampo" ~ "Michoac치n",
      NOM_ENT == "Veracruz de Ignacio de la Llave" ~ "Veracruz",
      TRUE ~ NOM_ENT
    ))

#union
union0 <- left_join(estados,pob, by = c ("NOMGEO" = "NOM_ENT"))

#union0 tiene tanto la informaci칩n geogr치fica de cada estado como su poblaci칩n
head(union0)
```


### 2.4 Tabla demogr치fica

```{r message=FALSE, warning=FALSE}
#demo tendr치 s칩lo los estados, su 치rea y poblacipon total
demo <- union0 %>%
  select(NOMGEO,area_ha,Poblacion_total)

#Se crea una nuevacolumna de km2
demo <- demo %>%
  mutate(km2 = area_ha/100)

#para poder tener la densidad: poblaci칩n/km2 de cada estado.
demo <- demo %>%
  mutate(densidad = Poblacion_total/km2)

#qu칠 variables hay en demo
names(demo)
```

### 2.5 Mapa de M칠xico y densidad de poblaci칩n por estado
```{r message=FALSE, warning=FALSE}
#Verificamos los nombres de los estados en ambas bases
unique(mexshp$NOMGEO)

unique(demo$NOMGEO)
#Todos coinciden

#Combina las tablas geogr치fica y demogr치fica
mexdens <- mexshp %>%
  left_join(demo, by = "NOMGEO")

#Grafica el mapa
ggplot(mexdens) +
  geom_sf(aes(fill = densidad), color = "black", size = 0.2) +
  scale_fill_viridis_c(
    option = "magma",
    trans = "log",                 # 游댳 transformaci칩n logar칤tmica
    name = "Densidad (hab/km)",
    breaks = c(11, 50, 200, 700, 6197), # 游댳 puedes ajustar seg칰n tus datos
    labels = c("11", "50","200", "700", "6197")
  ) +
  theme_minimal() +
  labs(title = "Densidad poblacional por estado (INEGI 2020)",
       caption = "Fuente: Censo de Poblaci칩n y Vivienda 2020") +
  theme(plot.title = element_text(face = "bold", size = 14),
        legend.position = "right")
```

### 2.6 Contaminaci칩n
### 2.6.1 Contaminaci칩n por estado

```{r message=FALSE, warning=FALSE}
######Contaminantes por estado######
#Se guarda en cm la informaci칩n que existe en la tabla de mediciones promedio del a침o de contaminantes por municipio tomado en el a침o 2018
cm <- read_csv("contaminantes.csv")

#co es la tabla de los estados de M칠xico y la cantidad promedio de 7 contaminantes en el a침o 2018
co <- cm %>%
  #Dentro de cm...
  group_by(Entidad_federativa) %>%
  #Agrupa por entidades y...
  summarize(across(3:9, ~ mean(.x, na.rm = TRUE)
  #De las columnas de contaminantes (3:9), crea el promedio de todas las cantidades registras, creando una solo fila para cada estado
  ))

#Vemos las variables y tipos de datos de co, las emisiones promedio de cada contaminante por estado
head(co)

```

### 2.6.2 Contaminantes por tipo de fuente por estado

```{r message=FALSE, warning=FALSE}
#cpf tiene el promedio de 7 contaminantes por por tipo de fuente de cada estado de M칠xic
cpf <- cm %>%
  #Dentro de cm...
  group_by(Entidad_federativa, Tipo_de_Fuente) %>%
  #... agrupa por Entidad_federativa y Tipo de Fuente, luego...
  summarise(across(2:8, ~ mean(.x, na.rm = TRUE)))
#De las columnas 2:8 (contaminantes) saca su promedio y colocalos en filas separadas

head(cpf)
#cpf tiene el promedio de 7 contaminantes por por tipo de fuente de cada estado de M칠xico
```


### 2.7 Mapas de M칠xico y contaminantes por estado
### 2.7.1 Ajuste de bases de datos

```{r message=FALSE, warning=FALSE}
#Verificamos que ambas bases manejen los mismos nombres por entidad
unique(co$Entidad_federativa)
unique(mexshp$NOMGEO)
#Coahuila y Edomex no coinciden

#Modificamos
mexshp <- mexshp %>%
  #Dentro de pob...
  mutate( #...modifica las colmunas.
    NOMGEO = case_when( #En espec칤fico a esta <<En caso de...>>
      NOMGEO == "Estado de M칠xico" ~ "M칠xico",
      NOMGEO  == "Coahuila de Zaragoza" ~ "Coahuila",
      TRUE ~ NOMGEO
    ))

#Creamos una nueva tabla que comnbina los datos de emisiones con la geograf칤a
mexco <- mexshp %>%
  left_join(co, by = c("NOMGEO" ="Entidad_federativa"))
```

### 2.7.2 Mapas por contamiante

### Di칩xido de Azufre
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = SO_2 ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de So2 por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Mon칩xido de carbono
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = CO ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de CO por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### 칍xidos de Nitrogeno
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = NOx ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de NOx por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Compuestos org치inicos vol치tiles
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = COV ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de COV por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Particulas menores o iguales a 10 micras
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = PM_010 ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de PM 10 por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Particulas menores o iguales a 2.5 micras
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = PM_2_5 ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de PM 2.5 por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

### Amoniaco
```{r message=FALSE, warning=FALSE}
ggplot(mexco) +
  geom_sf(aes(fill = NH_3 ), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Emisi칩n (ton/a침o)") +
  theme_minimal() +
  labs(title = "Emisiones de NH3 por estado",
       caption = "Inventario Nacional de Emisiones") +
  theme(plot.title = element_text(face = "bold", size = 14))
```

## 3. An치lisis 

### 3.1 Uniones finales para los an치lisis

```{r message=FALSE, warning=FALSE}
##Cambio de nombre de estados##

#Se verifica los nombres de los estados que maneja cada base
unique(demo$NOMGEO)
unique(co$Entidad_federativa)
unique(cpf$Entidad_federativa)

demo <- demo %>%
  #Dentro de pob...
  mutate( #...modifica las colmunas.
    NOMGEO = case_when( #En espec칤fico a esta <<En caso de...>>
      NOMGEO == "Estado de M칠xico" ~ "M칠xico",
      NOMGEO  == "Coahuila de Zaragoza" ~ "Coahuila",
      TRUE ~ NOMGEO
    ))

#Se verifica si han sido cambiadas
unique(demo$NOMGEO)

###Uniones de tablas##

#union1 es la tabla que contiene a las entidades federativaS, el promedio de emisiones por contaminante m치s la poblacipon y densidad por estado.
union1 <- left_join(co,demo, by = c ("Entidad_federativa" = "NOMGEO"))

head(union1)

#union2 tiene la cantidad promedio de 7 contaminantes por su tipo de fuente de cada entidad federativa, m치s la poblaci칩n y densidad  de cada estado.
union2 <- left_join(cpf,demo, by = c ("Entidad_federativa" = "NOMGEO"))

head(union2)

```

### 3.2 Correlaci칩n entre densiad y contaminante

### 3.2.1 Modificaci칩n de la tabla para realizar los an치lisis

```{r message=FALSE, warning=FALSE}
##Modificaci칩n de la tabla para realizar los an치lisis##

dim(union2)
#Tabla original con 160 observaciones y 10 variables

#Se revisa el nombre y posici칩n de los contaminantes
names(union2)

bd_prueba <- union2 %>%
  #Dentro de union2...
  pivot_longer(
    #...cambiamos a formato largo (columnas a filas)
    cols = c(3:9),
    #Se determina de qu칠 columnas de crear치 una sola.
    names_to = "Contaminante",
    #Se le nombra
    values_to = "Emision"
    #Los valores que ten칤an se conviertne en otra con otro nombre
  )

#Cambiamos a formato largo, ahora una columna de Contaminante tendr치 enlistado los 7 tipos que coincidir치 con el tipo de fuente y emisi칩n reportada, m치s la poblaci칩n.
head(bd_prueba)

dim(bd_prueba)
#Nueva tabla con 1120 filas y solo 8 variables
```

### 3.2.2 Correlaci칩n entre densidad y tipo de contaminante
```{r message=FALSE, warning=FALSE}
cord <- bd_prueba %>%
  #Dentro de bd_prueba...
  group_by(Contaminante) %>%
  #...agrupa por contaminante y luego...
  summarise( #...crea una fila con...
    cor_densidad_emision = cor(densidad, Emision, use = "complete.obs")
    #...la correlaci칩n entre la poblaci칩n y la emisipon de cada contaminante.
  )


#Correlaci칩n entre los contaminantes y la densidad. Relaciones positivas o negativas indican que si entre m치s grande o m치s peque침a la densidad (cerca de 1 o -1) mayor o menor ser치 la emisi칩n de cada contaminante
cord

```

### Gr치fica de dispersi칩n
```{r fig.align='center', fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
ggplot(bd_prueba, aes(x = densidad, y = Emision, color = Tipo_de_Fuente)) +
  geom_point() +
  facet_wrap(~ Contaminante, scales = "free_y") +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  theme_minimal() +
  labs(title = "Relaci칩n entre poblaci칩n y emisiones por contaminante",
       x = "Poblaci칩n total del estado",
       y = "Emisi칩n reportada")
```

### 3.3  Relaci칩n entre contaminante y tipo de fuente

#### Di칩xido de azufre
```{r message=FALSE, warning=FALSE}
SO_2 <- subset(bd_prueba, Contaminante == "SO_2")
#Filtro de los datos con el contaminante seleccionado

anova_SO_2 <- aov(Emision ~ Tipo_de_Fuente, data = SO_2)
#Anova que compara entre tipos de fuente las emisiones registradas

summary(anova_SO_2)
#Resultado del Anova

tukey_SO_2 <- TukeyHSD(anova_SO_2)
#Entre qu칠 tipos de fuente hay mayor o menor diferencia,


#p aj muestra el valor p ajustado, qu칠 comparaciones son significativas 
#(<0.05), con esto se pueden ver qu칠 tipo o tipos de fuente tienen m치s relaci칩n con la cantidad qu eemite el contaminante. Si una o dos tipos se repiten en comparaciones con p adj <0.05, esas ser치n las que posean mayor relaci칩n con la emisi칩n de la particula.
#Gr치ficamente
tukey_SO_2

ggplot(SO_2, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de SO2 por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")
#Gr치fica de cajas y bigotes que compara las emisiones por tipo de fuente
```
##### Fuentes m치s relacionada con SO2: Fuentes Fijas


#### Mon칩xido de carbono
```{r message=FALSE, warning=FALSE}
CO <- subset(bd_prueba, Contaminante == "CO")
anova_CO <- aov(Emision ~ Tipo_de_Fuente, data = CO)
summary(anova_CO)
tukey_CO <- TukeyHSD(anova_CO)
#tukey_CO
#Gr치ficamente#
ggplot(CO, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de CO por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")

```
##### Fuentes m치s relacionada con CO: Fuentes M칩viles Carreteros


#### 칍xidos de nitr칩geno
```{r message=FALSE, warning=FALSE}
NOx <- subset(bd_prueba, Contaminante == "NOx")
anova_NOx <- aov(Emision ~ Tipo_de_Fuente, data = NOx)
summary(anova_NOx)
tukey_NOx <- TukeyHSD(anova_NOx)
#tukey_NOx
#Gr치ficamente#
ggplot(NOx, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de NOx por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")
```
##### Fuentes m치s relacionada con NOx: Fuentes M칩viles Carreteros


#### Compuestos Org치nicos Vol치tiles
```{r message=FALSE, warning=FALSE}
COV <- subset(bd_prueba, Contaminante == "COV")
anova_COV <- aov(Emision ~ Tipo_de_Fuente, data = COV)
summary(anova_COV)
tukey_COV <- TukeyHSD(anova_COV)
#tukey_COV
#Gr치ficamente#
ggplot(COV, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de COV por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")
```
##### Fuentes m치s relacionada con COV: Fuentes Naturales


#### Particulas iguales o menores a 10 micras
```{r message=FALSE, warning=FALSE}
PM_010 <- subset(bd_prueba, Contaminante == "PM_010")
anova_PM_010 <- aov(Emision ~ Tipo_de_Fuente, data = PM_010)
summary(anova_PM_010)
tukey_PM_010 <- TukeyHSD(anova_PM_010)
#tukey_PM_010
#Gr치ficamente#
ggplot(PM_010, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de PM10 por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")
```
##### Fuentes m치s relacionada con PM10: Fuentes de 츼rea y Fuentes Fijas


#### Particulas iguales o menores a 2.5 micras
```{r message=FALSE, warning=FALSE}
PM_2_5 <- subset(bd_prueba, Contaminante == "PM_2_5")
anova_PM_2_5 <- aov(Emision ~ Tipo_de_Fuente, data = PM_2_5)
summary(anova_PM_2_5)
tukey_PM_2_5 <- TukeyHSD(anova_PM_2_5)
#tukey_PM_2_5
#Gr치ficamente#
ggplot(PM_2_5, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de PM2.5 por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")
```
##### Fuentes m치s relacionada con PM2.5: Fuentes Fijas


#### Amoniaco
```{r message=FALSE, warning=FALSE}
NH_3 <- subset(bd_prueba, Contaminante == "NH_3")
anova_NH_3 <- aov(Emision ~ Tipo_de_Fuente, data = NH_3)
summary(anova_NH_3)
tukey_NH_3 <- TukeyHSD(anova_NH_3)
#tukey_NH_3
#Gr치ficamente#
ggplot(NH_3, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) +
  labs(title = "Emisiones de NH_3 por tipo de fuente",
       y = "Emisi칩n",
       x = "Tipo de fuente")

```
##### Fuentes m치s relacionada con NH3, Fuentes de 츼rea


### Gr치fico completo
```{r fig.align='center', fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
ggplot(bd_prueba, aes(x = Tipo_de_Fuente, y = Emision, fill = Tipo_de_Fuente)) +
  geom_boxplot(outlier.shape = NA) +
  facet_wrap(~Contaminante, scales = "free_y") +
  theme_minimal() +
  scale_x_discrete(labels = c(
    "Fuentes de 치rea" = "FA",
    "Fuentes fijas" = "FF",
    "Fuentes m칩viles carreteros" = "FMC",
    "Fuentes m칩viles que no circulan por carretera" = "FMNC",
    "Fuentes naturales" = "FN")) 
```


#### Con esto podemos resolver la 1춿 pregunta: 쯈u칠 tipos de fuentes contribuyeron m치s a la emisi칩n de cada tipo de contaminate? Pues cada una o m치s emiten ciertos contaminantes en mayor medida que otros, por ejemplo, las fuentes naturales emiten m치s COV que las dem치s, mientras que el Amoniaco (NH3) es emitido principalmente por medio de fuentes de 치rea.

### 3.4 Relaci칩n entre estados y contaminantes
### 3.4.1 Regiones
```{r}
#Creamos una nueva columna (region) asignando a los estados correspondientes
co$region <- case_when(
  co$Entidad_federativa %in% c("Baja California", "Sonora", "Chihuahua", "Durango", "Sinaloa", "Baja California Sur") ~ "Noroeste",
  co$Entidad_federativa %in% c("Coahuila", "Nuevo Le칩n", "Tamaulipas") ~ "Noreste",
  co$Entidad_federativa %in% c("Nayarit", "Jalisco", "Colima", "Michoac치n") ~ "Occidente",
  co$Entidad_federativa %in% c("Zacatecas", "Aguascalientes", "San Luis Potos칤", "Guanajuato") ~ "Baj칤o",
  co$Entidad_federativa %in% c("Quer칠taro", "Hidalgo", "Tlaxcala", "Puebla", "Ciudad de M칠xico","M칠xico", "Morelos") ~ "Centro",
  co$Entidad_federativa %in% c("Guerrero", "Oaxaca", "Chiapas") ~ "Sur",
  co$Entidad_federativa %in% c("Tabasco", "Campeche", "Yucat치n","Quintana Roo","Veracruz") ~ "Sureste",
  TRUE ~ "Otra"
)
```

### 3.4.2 PCA
```{r}
#Para el PCA, vamos a usar los datos de las las columnas 2 - 8, que corresponden a los contamiantes
pca_data <- co %>% select(2:8)

#Se guarda el PCA, asegurando que todos tengan una escala cercana para no estar afectados por la variaci칩n
pca_result <- prcomp(pca_data, scale. = TRUE)

#Podemos ver la Desviacipon estandar y las proporciones que explican cada Componentes, as칤 com ola acumulativa
summary(pca_result)
#Los dos primeros componentes ya explican ~74%, y con el 3춿, ~84%
```

### Gr치ficamente
```{r}
autoplot(pca_result, 
         data = co, 
         colour = "region",      # colores por regi칩n
         label = TRUE,           # mostrar nombre del estado
         loadings = TRUE,        # mostrar vectores de contaminantes
         loadings.label = TRUE,  # mostrar nombres de contaminantes
         loadings.label.size = 3,
         loadings.colour = "gray40") +
  scale_color_manual(values = c("Noroeste" = "red",
                                "Noreste" = "orange",
                                "Occidente" = "yellow",
                                "Baj칤o" = "darkgreen",
                                "Centro" = "green",
                                "Sur" = "blue",
                                "Sureste" = "purple"
                                )) +
  theme_minimal() +
  labs(title = "PCA de emisiones de contaminantes por estado",
       subtitle = "Color por regi칩n geogr치fica",
       x = "Componente principal 1",
       y = "Componente principal 2") +
  theme(plot.title = element_text(face = "bold"),
        legend.position = "right")

#Esta gr치fica muestra la influencia de los dos primeros componentes principales, y muestra por color a qu칠 regi칩n pertenecen
```

### Se pueden responder las otras preguntas: 쮺칩mo se agrupan los estados de M칠xico seg칰n su perfil de emisiones de distintos contaminantes, y qu칠 contaminantes explican esas diferencias?

### Grupos claros no son visibles, aunque la mayor칤a est치 negativamente relacionada a las emisiones de PM 10, PM 2.5, 칍xidos de nitr칩geno y Mon칩xido de carbono. Mientras que existen particularidades, pues tanto en los mapas como en la anterior gr치fica, hay estados que emiten ciertos contaminantes m치s que otros: Aguascalientes (1) con el Amoniaco, Campeche(4) y Baja California Sur(3) con el Di칩xido de Azufre (SO2), y Baja California (2) con el Mon칩xido de Carbono.

## Conclusi칩n
### S칤 existen diferencias entre la emisi칩n de contaminantes en M칠xico, habiendo estaddos que emiten determinados contamiantes m치s que otros, y al mismo tiempo, las fuentes de esos contaminantes tambien presentan diferencias en la cantidad que emiten de cada uno de las particulas registradas.

### Para una mejor interpretaci칩n del porqu칠 de esta din치mica, se podr칤a a침adir, por ejemplo, qu칠 actividad econ칩mica se realiza con mayor intensidad en cada estado. Pudiendo ser una mejor explicaci칩n que la regi칩n en la que se encuentran.
